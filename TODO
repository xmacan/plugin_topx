zkusit testovat hdd used/total. U disku vstupuje do hry cache, uvidime tam
// vsechny data tykajici se hdd
select local_data_id from data_template_data WHERE data_template_id = 43
//
ted je zacit prochazet a ke vsem najit total a used
 select * from data_source_stats_hourly where local_data_id=27060;
+---------------+-----------+--------------+--------------+
| local_data_id | rrd_name  | average      | peak         |
+---------------+-----------+--------------+--------------+
|         27060 | hdd_total | 107267223552 | 107267223552 |
|         27060 | hdd_used  |  77722482688 |  77723451392 |
+---------------+-----------+--------------+--------------+

 select t2.local_data_id, t2.rrd_name,t2.average from data_template_data join data_source_stats_hourly as t2 on t2.local_data_id = data_template_data.local_data_id WHERE data_template_id = 43;


!!! TOHLE VYSE FUNGUJE, ted ladim disky, hledej hlasku tady jsem skoncil



SELECT t1.local_data_id as local_data_id, concat(t1.name_cache,' - ', t2.rrd_name) as name, t2.average as value,
t2.peak as peak FROM data_template_data AS t1 LEFT JOIN data_source_stats_daily AS t2 ON t1.local_data_id = t2.local_data_id WHERE t1.data_template_id = 38 ORDER BY t2.average desc LIMIT 10;
-- tohle mi vyjede treba vsechny error_in

select * from data_local where data_template_id=38 and host_id=365;
-- tohle mi vyjede od toho hosta vsechny error_in vsech sitovek

+-------+------------------+---------+---------------+------------+--------+
| id    | data_template_id | host_id | snmp_query_id | snmp_index | orphan |
+-------+------------------+---------+---------------+------------+--------+
| 23071 |               38 |     365 |             1 | 1          |      0 |
| 23072 |               38 |     365 |             1 | 2          |      0 |
| 23073 |               38 |     365 |             1 | 3          |      0 |
+-------+------------------+---------+---------------+------------+--------+

select * from data_template_data where local_data_id=23073;
-- takhle se zeptam na informace o jednotlivych sitovkach, ale to jeste neni to co potrebuju

SPARVNEJSI CEStA:
root@localhost [cacti]> select DISTINCT t2.data_source_name, t1.data_source_path,t2.local_data_id, t2.data_source_type_id, t2.data_template_id from data_template_data as t1, data_template_rrd as t2  where (t1.local_data_id = t2.local_data_id and t1.data_template_id = t2.data_template_id) and  t1.data_template_id in (38) limit 10,4;
+------------------+----------------------------------------------+---------------+---------------------+------------------+
| data_source_name | data_source_path                             | local_data_id | data_source_type_id | data_template_id |
+------------------+----------------------------------------------+---------------+---------------------+------------------+
| discards_out     | <path_rra>/zeotrade_-_bsd_errors_in_6541.rrd |          6541 |                   2 |               38 |
| errors_out       | <path_rra>/zeotrade_-_bsd_errors_in_6541.rrd |          6541 |                   2 |               38 |
| errors_in        | <path_rra>/zeotrade_-_bsd_errors_in_6542.rrd |          6542 |                   2 |               38 |
| discards_in      | <path_rra>/zeotrade_-_bsd_errors_in_6542.rrd |          6542 |                   2 |               38 |
+------------------+----------------------------------------------+---------------+---------------------+------------------+
--- takhle si vyjedu vsechny

--- ted je potrebuju dle neceho sparovat, stary kod to delal dle local_data_id a souboru
-- jenze stary kod dostaval nejaky pole z polleru

 select DISTINCT t2.data_source_name, t1.data_source_path,t2.local_data_id, t2.data_source_type_id, t2.data_template_id from data_template_data as t1, data_template_rrd as t2  where (t1.local_data_id = t2.local_data_id and t1.data_template_id = t2.data_template_id) and  t1.local_data_id=23071;
+------------------+--------------------------------------------+---------------+---------------------+------------------+
| data_source_name | data_source_path                           | local_data_id | data_source_type_id | data_template_id |
+------------------+--------------------------------------------+---------------+---------------------+------------------+
| errors_in        | <path_rra>/gymji_-_nas_errors_in_23071.rrd |         23071 |                   2 |               38 |
| discards_in      | <path_rra>/gymji_-_nas_errors_in_23071.rrd |         23071 |                   2 |               38 |
| discards_out     | <path_rra>/gymji_-_nas_errors_in_23071.rrd |         23071 |                   2 |               38 |
| errors_out       | <path_rra>/gymji_-_nas_errors_in_23071.rrd |         23071 |                   2 |               38 |
+------------------+--------------------------------------------+---------------+---------------------+------------------+

tady uz data umim vytahnout:
root@localhost [cacti]> select * from data_source_stats_daily where local_data_id=23071;
+---------------+--------------+---------+------+
| local_data_id | rrd_name     | average | peak |
+---------------+--------------+---------+------+
|         23071 | discards_in  |       0 |    0 |
|         23071 | discards_out |       0 |    0 |
|         23071 | errors_in    |       0 |    0 |
|         23071 | errors_out   |       0 |    0 |
+---------------+--------------+---------+------+
4 rows in set (0.001 sec)

root@localhost [cacti]> select * from data_source_stats_weekly where local_data_id=23071;
+---------------+--------------+---------+------+
| local_data_id | rrd_name     | average | peak |
+---------------+--------------+---------+------+
|         23071 | discards_in  |       0 |    0 |
|         23071 | discards_out |       0 |    0 |
|         23071 | errors_in    |       0 |    0 |
|         23071 | errors_out   |       0 |    0 |
+---------------+--------------+---------+------+
4 rows in set (0.001 sec)

root@localhost [cacti]> select * from data_source_stats_monthly where local_data_id=23071;
+---------------+--------------+---------+------+
| local_data_id | rrd_name     | average | peak |
+---------------+--------------+---------+------+
|         23071 | discards_in  |       0 |    0 |
|         23071 | discards_out |       0 |    0 |
|         23071 | errors_in    |       0 |    0 |
|         23071 | errors_out   |       0 |    0 |
+---------------+--------------+---------+------+
-- problem je u hourly - typicky u error/discard


KOMPLETNI DISK

root@localhost [cacti]>  select * from data_template_data  where data_source_path like '%nmaya%used%';
+-------+-----------------------------+---------------+------------------+---------------+--------+----------------------------------------------------------+---------------------------------------------------------------+----------------------------------------------------+----------+--------+------------+----------+--------------------------+------------------------+
| id    | local_data_template_data_id | local_data_id | data_template_id | data_input_id | t_name | name                                                     | name_cache                                                    | data_source_path                                   | t_active | active | t_rrd_step | rrd_step | t_data_source_profile_id | data_source_profile_id |
+-------+-----------------------------+---------------+------------------+---------------+--------+----------------------------------------------------------+---------------------------------------------------------------+----------------------------------------------------+----------+--------+------------+----------+--------------------------+------------------------+
| 13432 |                          56 |         13119 |               43 |            12 |        | |host_description| - Used Space - |query_hrStorageDescr| | Kostax - PVT - nmaya - Used Space - /, type: ufs, dev: /dev/d | <path_rra>/kostax_-_pvt_-_nmaya_hdd_used_13119.rrd |          | on     |            |      300 |                          |                      1 |
| 13433 |                          56 |         13120 |               43 |            12 |        | |host_description| - Used Space - |query_hrStorageDescr| | Kostax - PVT - nmaya - Used Space - /usr/local/www, type: ufs | <path_rra>/kostax_-_pvt_-_nmaya_hdd_used_13120.rrd |          | on     |            |      300 |                          |                      1 |
| 13434 |                          56 |         13121 |               43 |            12 |        | |host_description| - Used Space - |query_hrStorageDescr| | Kostax - PVT - nmaya - Used Space - /zaloha, type: ufs, dev:  | <path_rra>/kostax_-_pvt_-_nmaya_hdd_used_13121.rrd |          | on     |            |      300 |                          |                      1 |
| 27331 |                          56 |         26966 |               43 |            12 |        | |host_description| - Used Space - |query_hrStorageDescr| | Kostax - PVT - nmaya - Used Space - /var/db/mysql, type: ufs, | <path_rra>/kostax_-_pvt_-_nmaya_hdd_used_26966.rrd |          | on     |            |      300 |                          |                      3 |
+-------+-----------------------------+---------------+------------------+---------------+--------+----------------------------------------------------------+---------------------------------------------------------------+----------------------------------------------------+----------+--------+------------+----------+--------------------------+------------------------+
4 rows in set (0.021 sec)

root@localhost [cacti]>  select * from data_source_stats_monthly where local_data_id=13120;
+---------------+-----------+-------------------+--------------------+
| local_data_id | rrd_name  | average           | peak               |
+---------------+-----------+-------------------+--------------------+
|         13120 | hdd_total |      176785518592 |       176785518592 |
|         13120 | hdd_used  | 99814700064.01924 | 134819558795.94667 |
+---------------+-----------+-------------------+--------------------+
2 rows in set (0.001 sec)

root@localhost [cacti]>  select * from data_source_stats_hourly where local_data_id=13120;
+---------------+-----------+-------------------+--------------+
| local_data_id | rrd_name  | average           | peak         |
+---------------+-----------+-------------------+--------------+
|         13120 | hdd_total |      176785518592 | 176785518592 |
|         13120 | hdd_used  | 94412993194.66667 |  94415507456 |
+---------------+-----------+-------------------+--------------+



ted zacit delat treba soucet trafficu

nadpis funguje jen u unsupported



u traffic errors mam podezrele stejna cisla


tady mam jedinecna data
select * from data_source_stats_hourly_last where local_data_id=11327;
select * from data_template_data where local_data_id=11327;

A ve starem kodu uz mam:
// zjistuju, ktera data budu zkoumat
$result = db_fetch_assoc ("select distinct (data_template.id) as id from plugin_topx_source join data_template
on data_template.hash = plugin_topx_source.hash");

        foreach($result as $row)        {
   $in .= $row["id"] . ",";
}



udelam to tak, ze v poller bottom si vytahnu z tabulky ...hourly_last data dle pozadovanych hashu a ty zpracuju
- asi nepotrebuju ani poller, muzu to rovnou brat z tabulek, viz nize

ale jak je zpracuju? Ja ty hodnoty mozna ukladat nemusim, ... muzu brat z db - hodina, den, tyde, mesic, rok
ano, udelat to tak a jeste muzu pridat last 5 minut


asi by bylo dobre u tech supported mit vychozi order by - mam to v db, ale jeste to cele prekopat



bude potreba resit i jednotky, mikrotik uptime ted mam jako 1.94G



topx with user permission? Now I'm displaying all host


